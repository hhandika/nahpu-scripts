---
title: "NAHPU Export Data Cleaning"
author: "Heru Handika"
date: "2023-06-16"
output: html_document
---

```{r}
if (!require("pacman")) {
  install.packages("pacman")
} 

pacman::p_load(readr)
pacman::p_load(dplyr)
pacman::p_load(here)
pacman::p_load(tidyr)

source(here::here("R", "lsumz_data_cleaning.R"))
```


```{r}
path <- here::here("data", "hh_gede2023_specimenRecords.csv")

df <- readr::read_csv(path)
```

```{r}
cleaned.df <-clean_collname(df) 

prepType.df <- prepType.colnames |>
  purrr::map(split_prepType) |>
  purrr::reduce(left_join, by = "specimenUUID")

coordinate.df <- coordinates.colnames |>
  purrr::map(split_coordinate) |>
  purrr::reduce(left_join, by = "specimenUUID")

final.df <- cleaned.df |>
  dplyr::select(!starts_with(c("PrepType", "Coordinate"))) |>
  dplyr::left_join(coordinate.df, by = "specimenUUID") |>
  dplyr::left_join(prepType.df, by = "specimenUUID")

readr::write_csv(final.df, here::here("results", "cleaned_lsumz_upload.csv"), na = "")
```

